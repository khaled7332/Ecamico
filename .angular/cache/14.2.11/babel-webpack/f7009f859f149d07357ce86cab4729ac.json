{"ast":null,"code":"'use strict';\n/**\n * Dependencies\n */\n\nconst {\n  Client\n} = require('@sendgrid/client');\n\nconst {\n  classes: {\n    Mail\n  }\n} = require('@sendgrid/helpers');\n/**\n * Mail service class\n */\n\n\nclass MailService {\n  /**\n   * Constructor\n   */\n  constructor() {\n    // Set client, initialize substitution wrappers and secret rules filter.\n    this.setClient(new Client());\n    this.setSubstitutionWrappers('{{', '}}');\n    this.secretRules = [];\n  }\n  /**\n   * Set client\n   */\n\n\n  setClient(client) {\n    this.client = client;\n    return this;\n  }\n  /**\n   * SendGrid API key passthrough for convenience.\n   */\n\n\n  setApiKey(apiKey) {\n    this.client.setApiKey(apiKey);\n    return this;\n  }\n  /**\n   * Twilio Email Auth passthrough for convenience.\n   */\n\n\n  setTwilioEmailAuth(username, password) {\n    this.client.setTwilioEmailAuth(username, password);\n  }\n  /**\n   * Set client timeout\n   */\n\n\n  setTimeout(timeout) {\n    if (typeof timeout === 'undefined') {\n      return;\n    }\n\n    this.client.setDefaultRequest('timeout', timeout);\n  }\n  /**\n   * Set substitution wrappers\n   */\n\n\n  setSubstitutionWrappers(left, right) {\n    if (typeof left === 'undefined' || typeof right === 'undefined') {\n      throw new Error('Must provide both left and right side wrappers');\n    }\n\n    if (!Array.isArray(this.substitutionWrappers)) {\n      this.substitutionWrappers = [];\n    }\n\n    this.substitutionWrappers[0] = left;\n    this.substitutionWrappers[1] = right;\n    return this;\n  }\n  /**\n   * Set secret rules for filtering the e-mail content\n   */\n\n\n  setSecretRules(rules) {\n    if (!(rules instanceof Array)) {\n      rules = [rules];\n    }\n\n    const tmpRules = rules.map(function (rule) {\n      const ruleType = typeof rule;\n\n      if (ruleType === 'string') {\n        return {\n          pattern: new RegExp(rule)\n        };\n      } else if (ruleType === 'object') {\n        // normalize rule object\n        if (rule instanceof RegExp) {\n          rule = {\n            pattern: rule\n          };\n        } else if (rule.hasOwnProperty('pattern') && typeof rule.pattern === 'string') {\n          rule.pattern = new RegExp(rule.pattern);\n        }\n\n        try {\n          // test if rule.pattern is a valid regex\n          rule.pattern.test('');\n          return rule;\n        } catch (err) {// continue regardless of error\n        }\n      }\n    });\n    this.secretRules = tmpRules.filter(function (val) {\n      return val;\n    });\n  }\n  /**\n   * Check if the e-mail is safe to be sent\n   */\n\n\n  filterSecrets(body) {\n    if (typeof body === 'object' && !body.hasOwnProperty('content')) {\n      return;\n    }\n\n    const self = this;\n    body.content.forEach(function (data) {\n      self.secretRules.forEach(function (rule) {\n        if (rule.hasOwnProperty('pattern') && !rule.pattern.test(data.value)) {\n          return;\n        }\n\n        let message = `The pattern '${rule.pattern}'`;\n\n        if (rule.name) {\n          message += `identified by '${rule.name}'`;\n        }\n\n        message += ' was found in the Mail content!';\n        throw new Error(message);\n      });\n    });\n  }\n  /**\n   * Send email\n   */\n\n\n  send(data, isMultiple = false, cb) {\n    //Callback as second parameter\n    if (typeof isMultiple === 'function') {\n      cb = isMultiple;\n      isMultiple = false;\n    } //Array? Send in parallel\n\n\n    if (Array.isArray(data)) {\n      //Create promise\n      const promise = Promise.all(data.map(item => {\n        return this.send(item, isMultiple);\n      })); //Execute callback if provided\n\n      if (cb) {\n        promise.then(result => cb(null, result)).catch(error => cb(error, null));\n      } //Return promise\n\n\n      return promise;\n    } //Send mail\n\n\n    try {\n      //Append multiple flag to data if not set\n      if (typeof data.isMultiple === 'undefined') {\n        data.isMultiple = isMultiple;\n      } //Append global substitution wrappers if not set in data\n\n\n      if (typeof data.substitutionWrappers === 'undefined') {\n        data.substitutionWrappers = this.substitutionWrappers;\n      } //Create Mail instance from data and get JSON body for request\n\n\n      const mail = Mail.create(data);\n      const body = mail.toJSON(); //Filters the Mail body to avoid sensitive content leakage\n\n      this.filterSecrets(body); //Create request\n\n      const request = {\n        method: 'POST',\n        url: '/v3/mail/send',\n        headers: mail.headers,\n        body\n      }; //Send\n\n      return this.client.request(request, cb);\n    } catch (error) {\n      //Pass to callback if provided\n      if (cb) {\n        // eslint-disable-next-line callback-return\n        cb(error, null);\n      } //Reject promise\n\n\n      return Promise.reject(error);\n    }\n  }\n  /**\n   * Send multiple emails (shortcut)\n   */\n\n\n  sendMultiple(data, cb) {\n    return this.send(data, true, cb);\n  }\n\n} //Export class\n\n\nmodule.exports = MailService;","map":{"version":3,"names":["Client","require","classes","Mail","MailService","constructor","setClient","setSubstitutionWrappers","secretRules","client","setApiKey","apiKey","setTwilioEmailAuth","username","password","setTimeout","timeout","setDefaultRequest","left","right","Error","Array","isArray","substitutionWrappers","setSecretRules","rules","tmpRules","map","rule","ruleType","pattern","RegExp","hasOwnProperty","test","err","filter","val","filterSecrets","body","self","content","forEach","data","value","message","name","send","isMultiple","cb","promise","Promise","all","item","then","result","catch","error","mail","create","toJSON","request","method","url","headers","reject","sendMultiple","module","exports"],"sources":["D:/grad project/examico project/Ecamico/node_modules/@sendgrid/mail/src/classes/mail-service.js"],"sourcesContent":["'use strict';\n\n/**\n * Dependencies\n */\nconst {Client} = require('@sendgrid/client');\nconst {classes: {Mail}} = require('@sendgrid/helpers');\n\n/**\n * Mail service class\n */\nclass MailService {\n\n  /**\n   * Constructor\n   */\n  constructor() {\n\n    // Set client, initialize substitution wrappers and secret rules filter.\n    this.setClient(new Client());\n    this.setSubstitutionWrappers('{{', '}}');\n    this.secretRules = [];\n  }\n\n  /**\n   * Set client\n   */\n  setClient(client) {\n    this.client = client;\n\n    return this;\n  }\n\n  /**\n   * SendGrid API key passthrough for convenience.\n   */\n  setApiKey(apiKey) {\n    this.client.setApiKey(apiKey);\n\n    return this;\n  }\n\n  /**\n   * Twilio Email Auth passthrough for convenience.\n   */\n  setTwilioEmailAuth(username, password) {\n    this.client.setTwilioEmailAuth(username, password);\n  }\n\n  /**\n   * Set client timeout\n   */\n  setTimeout(timeout) {\n    if (typeof timeout === 'undefined') {\n      return;\n    }\n\n    this.client.setDefaultRequest('timeout', timeout);\n  }\n\n  /**\n   * Set substitution wrappers\n   */\n  setSubstitutionWrappers(left, right) {\n    if (typeof left === 'undefined' || typeof right === 'undefined') {\n      throw new Error('Must provide both left and right side wrappers');\n    }\n    if (!Array.isArray(this.substitutionWrappers)) {\n      this.substitutionWrappers = [];\n    }\n    this.substitutionWrappers[0] = left;\n    this.substitutionWrappers[1] = right;\n\n    return this;\n  }\n\n  /**\n   * Set secret rules for filtering the e-mail content\n   */\n  setSecretRules(rules) {\n    if (!(rules instanceof Array)) {\n      rules = [rules];\n    }\n\n    const tmpRules = rules.map(function (rule) {\n      const ruleType = typeof rule;\n\n      if (ruleType === 'string') {\n        return {\n          pattern: new RegExp(rule),\n        };\n      } else if (ruleType === 'object') {\n        // normalize rule object\n        if (rule instanceof RegExp) {\n          rule = {\n            pattern: rule,\n          };\n        } else if (rule.hasOwnProperty('pattern')\n          && (typeof rule.pattern === 'string')\n        ) {\n          rule.pattern = new RegExp(rule.pattern);\n        }\n\n        try {\n          // test if rule.pattern is a valid regex\n          rule.pattern.test('');\n          return rule;\n        } catch (err) {\n          // continue regardless of error\n        }\n      }\n    });\n\n    this.secretRules = tmpRules.filter(function (val) {\n      return val;\n    });\n  }\n\n  /**\n   * Check if the e-mail is safe to be sent\n   */\n  filterSecrets(body) {\n    if ((typeof body === 'object') && !body.hasOwnProperty('content')) {\n      return;\n    }\n\n    const self = this;\n\n    body.content.forEach(function (data) {\n      self.secretRules.forEach(function (rule) {\n        if (rule.hasOwnProperty('pattern')\n          && !rule.pattern.test(data.value)\n        ) {\n          return;\n        }\n\n        let message = `The pattern '${rule.pattern}'`;\n\n        if (rule.name) {\n          message += `identified by '${rule.name}'`;\n        }\n\n        message += ' was found in the Mail content!';\n\n        throw new Error(message);\n      });\n    });\n  }\n\n  /**\n   * Send email\n   */\n  send(data, isMultiple = false, cb) {\n\n    //Callback as second parameter\n    if (typeof isMultiple === 'function') {\n      cb = isMultiple;\n      isMultiple = false;\n    }\n\n    //Array? Send in parallel\n    if (Array.isArray(data)) {\n\n      //Create promise\n      const promise = Promise.all(data.map(item => {\n        return this.send(item, isMultiple);\n      }));\n\n      //Execute callback if provided\n      if (cb) {\n        promise\n          .then(result => cb(null, result))\n          .catch(error => cb(error, null));\n      }\n\n      //Return promise\n      return promise;\n    }\n\n    //Send mail\n    try {\n\n      //Append multiple flag to data if not set\n      if (typeof data.isMultiple === 'undefined') {\n        data.isMultiple = isMultiple;\n      }\n\n      //Append global substitution wrappers if not set in data\n      if (typeof data.substitutionWrappers === 'undefined') {\n        data.substitutionWrappers = this.substitutionWrappers;\n      }\n\n      //Create Mail instance from data and get JSON body for request\n      const mail = Mail.create(data);\n      const body = mail.toJSON();\n\n      //Filters the Mail body to avoid sensitive content leakage\n      this.filterSecrets(body);\n\n      //Create request\n      const request = {\n        method: 'POST',\n        url: '/v3/mail/send',\n        headers: mail.headers,\n        body,\n      };\n\n      //Send\n      return this.client.request(request, cb);\n    } catch (error) {\n\n      //Pass to callback if provided\n      if (cb) {\n        // eslint-disable-next-line callback-return\n        cb(error, null);\n      }\n\n      //Reject promise\n      return Promise.reject(error);\n    }\n  }\n\n  /**\n   * Send multiple emails (shortcut)\n   */\n  sendMultiple(data, cb) {\n    return this.send(data, true, cb);\n  }\n}\n\n//Export class\nmodule.exports = MailService;\n"],"mappings":"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"},"metadata":{},"sourceType":"script"}